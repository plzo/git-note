1、回归分类实验对齐。  1.5d
2、深南电路-金白9000数据对齐和讨论。  1.5d
3、多通道和单通道回归分类实验。  2d

1、已完成。回溯代码，发现数据增强部分处理有bug，修复后指标提升10个点和现场一致。
2、进行中。根据AI的测试结果对标签进行修正，同时考虑对工艺标准相近，外观相似的缺陷进行归类。
3、进行中。针对class1和class2的多通道回归分类不容易学到比对信息（是否考虑在回归分类网络中加入其他特征融合），测试集准确率85.6%；针对class3的单通道回归分类效果好，测试集准确率可达92.5%。

1、金白数据梳理对齐。
2、回归分类实验。


## 2020.09.17
1、3通道1500次效果有提升，0.8662，测试基线6通道1500次是否提升。
2、class2，3514数据，从i-minus换成i-minus-abs之后效果下降，0.9469到0.9156，训练1500次。
3、测试加权差分分割。

## 周报2020.09.21
1、修改回归分类模块。  1d
2、3通道，6通道回归分类实验。  3d
3、加权差分比对分割实验。  1d
4、数据梳理。 1d

1、加了一个参数用来控制是否将6通道的aqimg分成两张3通道图，同时给模板添加ok标签分开加入训练。
2、3通道训练集选取对指标的影响，3通道二分类漏检，6通道回归分类，6通道差分回归分类等。其中3通道回归分类指标提升较小(1个点）,6通道加差分，去绝对值，acc可达95%。
3、在基础数据集上做得实验，暂时只做了0.1、0.3、0.5三个权值。到0.5的时候指标接近baseline，0.1,0.3指标低于baseline，实际效果需看图，还没分析。
4、待完成。


1、数据梳理，去除错误数据，修正部分标签，按是否需要模板图分类。 1.5
2、加权差分比对分割实验及分析。 1
3、回归分类实验。 2.5
4、实验总结，讨论。  1

1、对照图，模板图放在一个batch训练，指标更高。
2、随机打乱比，对照图模板图同时在训练集指标高。
3、3通道对照6通道，指标并未有明显提升

## PCB回归分类技术路线
### 0827
Hi：
    今天下午关于深南电路-金白数据算法分析讨论的纪要和后续工作如下：
    现场漏检较多的缺陷类别包括：
        露铜、沾金、渗金、掉绿油桥、防焊杂质、刮伤、假漏、文字残缺、防焊上焊盘等。拟优先解决露铜、沾金、渗金。

    单独的回归分类和多通道分割目前不能解决的缺陷有：错位变形、小缺陷、弱缺陷。
    拟定技术路线：
        第一步：单图回归分类。针对部分只需要缺陷图就能检出的缺陷类别，分离缺陷图和对照图，将对照图作为OK数据喂给回归分类神经网络进行训练，期望得到优于多通道回归分类的指标。
        第二步：多图回归分类。针对部分需要对照图才能检出的缺陷类别，输入缺陷图和对照图。
        第三步：单图回归分类和多图回归分类为互补关系，测试数据并行通过两个回归分类网络，当网络同时检出OK时，将数据送往下一步；当其中一个网络为NG时，结果做NG处理；当两个网络输出同为NG且类别不同时，取得分高的类别NG为结果。
                    取前两步的OK数据喂给多通道分割模块（或比对分割），期望检出所有小缺陷。多通道分割（或比对分割）模型的训练取小缺陷数据为NG，其他数据皆为OK。
        第四步：拟定制化解决若缺陷，主要针对防焊杂质等缺陷类别。

后续工作计划：
    1、实验结果对齐（2天）。
    2、数据筛查对齐（约7天）。
        12参与人员：谢阳，罗娜娜，现场相关负责人员。
    3、实验验证单图和多图回归分类效果。（第一步，第二步）       
    4、实验验证多通道分割检出小缺陷。
        34参与人员：谢阳。
    5、定制检出弱缺陷的解决方案。

### 0915
Hi：
    今天上午关于比对分割及PCB项目的讨论纪要如下：
  1、PCB项目技术路线
  第一步：3通道回归分类（研发中） + 6通道回归分类（研发中）
  第二步：一般分割 + 比对分割（研发中）
  第三步：弱缺陷检出（方案待定）

  2、数据集粗分类
  在原有工艺分类的基础上将数据分为两大类：
  class1：需要同时观察缺陷图和对照图才能判断缺陷的数据。例如：少加工、漏塞孔、多加工、文字印错等。
  class2：只根据缺陷图就可以判断是否存在缺陷，缺陷类型的数据。例如：防焊杂质、防焊刮伤、大焊盘氧化等。
  部分根据工艺分类的类别，比如：文字反沾、焊盘凸起凹陷等，其中既有符合class1的数据，又有符合class2的数据，需对这些类别进行拆分。class1和class2可能同时包含 “ 文字反沾 ”。

  3、各模块数据集
  3通道回归分类：class2 + OK数据
  6通道回归分类：class1 + OK数据
  一般分割：class2的部分数据 + OK数据部分数据
  比对分割：class1的部分数据 + OK数据部分数据

  4、比对分割
  从class1中挑选数据划分训练集，测试集，测试集中数据必须是训练集中没有的，保证算法具有学习变化的能力。
  训练集中需包含小缺陷（基础试验用大缺陷），保证小缺陷的检出。
  以加权差分融合实验的结果作为baselin研究孪生网络。

  5、主要工作
  （1）数据分类class1、class2
  在剔除某些错位数据，修正标签的前提下，将原有工艺分类数据按能否单张识别缺陷将金白数据分为两大类。
  罗娜娜  周五
  （2）孪生网络实验，比对分割模块  陶斯琴
  （3）加权差分融合实验  谢阳
  （4）3通道、6通道回归分类实验  谢阳
  其中（2）（3）（4）需要（1）的数据。


## 需求理解

  回归分类 + 工程应用
  回归分类 + 特定的训练方法（剔除AI学习失败的数据） + 分割 + 传统算法
  筛选率60%，漏检0.01%~0.02%；

  客户标准：
  漏检：0.001%
  过检：越低越有竞争力。
  类间混淆：部分客户需要不良类型收集，其他客户没有要求。

  ## 周报20201012
  
  1、PCB项目方案复核。 1.5d
  2、和范泓对接实验结果，410的数据转换等。 0.5d
  3、指标计算相关脚本。  3d

  1、梳理方案流程，划定问题的研究范围，确定指标计算标准，后续工作和分工等。验收标准未知，需先明确现有指标。
  2、已完成。
  3、混淆矩阵（只按类型或细分到程度）及每一类的精度召回；缺陷全集和OK的精度、召回、acc、类间混淆率等；导入现场标准，计算缺陷和OK的精度召回。

  1、根据新的指标分析现有算法存在的问题，讨论确定验收标准和下一步的研究方向。
  2、箱子训练模块相关功能的迭代更新。

  1、深南数据处理，模型训练。
  2、OKR及相关例会。
  3、回归分类错例分析。
  4、回归分类验探索。

  1、已完成。
  2、已完成。挑选出优先解决的top 5缺陷类型。
  3、程度单一类别，程度仍然判错；部分热力图不在缺陷上。
  4、top 5缺陷回归分类（指标变差，漏检变多），直接分类。

  1、回归分类数据分析，实验探索分割+分类。
  2、进一步了解PCB算法整体流程，模块的边界，功能，局限性等。
  
  1、分割+回归分类，分割+分类，传统图像补漏；确认端到端结果漏检缺陷的模式形态；分析漏检分别对应每个子模块的原因；针对各个子模块的优化探索。



  


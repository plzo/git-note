### 20210426

1、整理现场收集的数据，测试新算法效果。
2、代码优化。

1、已完成。44类数据（大于150张）共14228张数据，在训练集测试集完全一致的情况下和回归分类对比。回归分类，类型召回84.1%，类型程度召回67.0%；新算法，类型召回91.82%，类型程度召回82.92%。新算法漏检8张，实际漏检2张，过检33张，混淆673张（230）。分类：刮伤，移动异物，沾油墨，污染和异物类缺陷混淆。分级：标注标准不一致。
2、优化部分函数实现和接口。

1、修改分类模块。
2、错例分析和实验总结。
3、优化分级网络效果。

### 20210506

1、PCB筛选算法实验分析、总结和汇报。
2、筛选算法库需求、功能和接口第一次讨论。
3、后续工作规划。
4、低对比度数据集准备。
5、修改分类模块，推理给出各类别置信度。

1、已完成。
2、已完成。给张辉演示了现有算法的功能指标和部分实现，基于现场软件，等待需求提出。
3、部分完成。筛选算法功能迭代相关工作暂未展开。
4、已完成。
5、已完成。

1、修改分类模块。
2、确定缺陷分级标准，维度。
3、筛选算法需求对接。


1、讨论
2、调试层别分析库
3、综合判断逻辑
4、aidi_vision420 roi模块修改
5、测试roi分类100模型
6、中间层分析

1、接口和demo
2、漏检分析

### 20210517

1、PCB项目相关讨论。
2、综合判断修改。
3、roi漏检分析。

1、Q2季度工作详细展开，时间节点，算法接口和需求。
2、获取各类别置信度，综合判断结果。
3、roi模块合并aidi_vision最新分支，打开last-fc和prob层和热力图，分析漏检（TOP3无漏检）。

1、筛选算法部分功能实现，同时给出算法接口文档和demo示例。
2、个人OKR。

### 20210524

1、筛选算法部接口和文档。
2、Q2季度OKR制定，任务细化。

1、已完成。根据现场需求，修改筛选算法接口，新增部分可视化功能，给出接口文档，发布。
2、已完成。

1、算法接口等待现场反馈，处理。
2、验证新的数据增强算法在分类任务上的有效性：
    缺陷是否被抹掉？
    哪些缺陷被抹掉？
    指标是否提升？
    关键性缺陷（掉桥等）能否检出？

### 20210531    
    
1、验证新的增强算法在分类任务上的有效性。
2、预处理加mask和网络加权对比实验。

1、a）无缺陷抹除，常规低对比度缺陷有效，掉桥无效。b）未在整个数据集上测试，整体指标提升未知。c）对掉桥，增强和RGB图，不符合预期，色域转换H通道，泛化性强，符号预期。
2、3组对照实验，实验指标上基本一致。

* 1、接口问题（封装成C，打包java接口？）
2、新低对比度增强算法验证（数据全集）
3、筛选算法库迭代更新(增加部分指标计算，部分函数实现不合理)

### 20210607
1、筛选算法库迭代更新(增加部分指标计算，部分函数重构)
2、筛选算法库封装java接口
3、新低对比度增强算法验证（数据全集）

1、已完成。
2、部分完成。学习swig，头文件封装成C，待测试。
3、未完成，仅训练模型。

1、筛选算法库封装java接口
2、新低对比度增强算法验证（数据全集）
3、ROI参数调优

### 20210615
1、筛选算法库封装java接口
2、新低对比度增强算法验证（数据全集）
3、ROI + 低对比度数据增强实验。

1、已完成。讨论了相关数据结构并交付。
2、收到两版C++实现，第一版增强对某些缺陷增强会改变原有颜色（绿油，氧化等），整体指标优于普通分类，第二版未测试。
3、针对ROI的加权方式，结合低对比度增强，做了多组对照实验，实验结果待分析。

1、将低对比度数据增强模块并入PCB筛选算法，分析测试。
2、ROI + 低对比度数据增强实验，结果分析。

### 20210621
1、ROI + 低对比度增强实验，结果分析。
2、合并增强模块，分析测试
3、ROI参数调优

1、固定加权参数，特征层+roi效果优于输入层，增强算法能有效降低漏检。
2、目前C++版增强效果和matlab版本还有差距。
3、阶跃优于高斯，加roi易检出小缺陷，但如果avi给出较大框则容易漏检。

1、ROI参数调优实验。
2、一些可视化工具。
3、实验结果分析总结。

### 20210628

1、训练、推理ROI加权方式研究。
2、可视化分类网络，包括特征层、gp层，各类别全连接权重blob等。

1、在特征层加ROI，训练采用外扩较大ROI，推理选择较小ROI，检出小缺陷。
2、roi-cls提取的特征比cls集中简洁，分析特征图的形状和激活权重可知，有的类别学到了期望特征，有的没有学到。

1、可视化结果分析。
2、分类网络性能边界分析。（哪些类别学不到期望缺陷特征，存在风险）

### 20200705

1、可视化结果分析。
2、分类网络性能边界分析。
3、阶段性实验梳理，总结汇报。

1、已完成。
2、部分完成（渗金、错位、曝虚等）。
3、已完成。

1、下阶段工作梳理。
2、综合判断策略。
3、掉桥实验。

### 20210712
1、下阶段工作梳理。
2、掉桥实验。
3、综合判断策略。

1、已完成。
2、色域转换可检出大部分掉桥缺陷，不完整掉桥漏检。
3、测试调整中。

1、新数据集。
2、综合判断策略。

### 20210719

1、增强算法对比（数据集指标）
2、增强算法cuda和aidi_vision冲突
3、平衡实验
4、新增hsv网络（roi-cls效果优秀，无漏检，无过检）
5、整理数据集（修复标签）

1000张图，平均48ms，最大209ms，最小13ms。
增强比较：91.33%，24，23  91.76%, 23, 22

1、增强算法对比与调试。
2、新增掉桥检测网络。
3、数据平衡实验
4、数据集初步整理。

1、协助申达解决aidi_vision初始化和cuda卡死的问题；c++版增强算法的直观效果和matlab已经非常接近，数据集上的acc相差0.5个点，在可接受的波动范围内；效率上显卡空载平均耗时16ms，半载48ms，需优化。
2、完成相关代码开发。roi准确的情况下，现有数据集无漏检过检。
3、类间数据存在数量级不平衡时（掉桥），数据平衡效果佳。类间数据量差距不大时效果不明显。
4、合并新老数据集，经复查，现有数据集的类别和ROI都存在较大问题，不合格标注在10%左右。

1、整理数据集（？）
2、综合判定策略。
3、联调测试（等待数据）。


### 20210726
上周工作：
1、联调测试（等待数据）。
2、筛选算法示例demo。
3、修改相关接口mat2char，打包c++，java发布。
4、算法效率分析优化。

1、未完成。暂未收到数据，无法获取层别分析结果，相关代码逻辑暂不可调试。
2、已完成。
3、已完成。
4、80ms优化至60ms。具体的，推理平均耗时24.6ms，增强32.3ms，读aqimg2.1ms，其他1.2ms。

本周计划：
1、联调测试（等待数据，周四）。
2、算法效率优化。

enhance ave time:               32.3119
net ave time:           24.6575
read ave time:          2.11436
other ave time:         1.24258

### 20210802

1、推理效率分析。
2、优化roi分类训练速度。
3、确定新label数据格式，解析。

1、已完成。
2、已完成。roi分类训练速度提升3倍接近普通分类训练速度。
3、确定了cam信息传递格式，收到小批数据，目前解析还存在问题。存在的问题：现有新数据未标注，数据量量小。

1、解析新数据，确定从通用层别到缺陷标签层别的映射逻辑和关系。
2、结合层别信息制定综合判断策略，相关代码调试。

### 20210809

1、解析新数据，完成从通用层别到标签层别的逻辑和映射关系。
2、c++，java接口调试，cmake-install和findpackage.
3、PCB数据集问题梳理和讨论。
4、结合层别分析结果的综合判断策略。

1、已完成。
2、已完成。
3、已完成。
4、代码完成，待测试。

1、新数据集上的联调测试。
2、java端回调函数。
3、降低混淆率（5组）
*4、数据集制作（无监督+微调）

### 20210816

1、联调测试。
2、清华数据集制作。
3、ADC测试工具软件需求讨论。
4、新版增强算法效果验证。

1、数据集质量较低，重复多，类别较少，标注一致性，非金白。a)cuda error  b）java读写中文乱码 c）传递loss信息。
2、20个类别，2w数据，逐类别划分，随机挑选。训练集50%-0.9,15%-0.81,8%-0.748（重复实验）
3、已完成。
4、增强分类漏检翻倍0.7%，0.15%，漏检情况需进一步分析。

1、增强分类漏检分析。
2、更新算法接口文档。
3、等待数据，判断逻辑调试。

### 20210823
1、增强分类漏检分析。
2、更新算法接口文档。
3、等待数据，判断逻辑调试。
4、外部配置文件更新测试。

1、对比实验，错例分析发现部分图像出现灰色色块导致分类错误，指标下降。反馈给申达后已解决。
2、已完成。
3、收到一批数据，400张，正在调试。
4、配置层别合并、层别下缺陷类别、缺陷排序、分级信息等。

1、层别判断逻辑调试
2、焊盘-错位、焊盘-渗金、焊盘-曝虚等漏检分析补漏。
3、优化分级网络。

### 20210830

1、层别判断逻辑调试。
2、解决java软件端相关问题。
3、分级网络性能分析。
4、深南数据集梳理的相关事项。
5、adc软件需求讨论
6、规则轮廓缺陷数据集制作。

1、已完成，并和士清确认了相关逻辑。
2、pcb软件的开发栈为java，下周发布第一版软件。协助解决了一些问题，包括java端算法运行宕机，模型读取，label读写等。
3、分级网络现有acc 85.5%，效果较差，标注存在较大问题。
4、已对接到负责现场工程同事。
5、已完成。
6、部分完成。分类算法实际漏检为7/6900，漏检7张有6张为规则轮廓缺陷。考虑制作数据集，后续工作由相关同事协助完成。

1、规则轮廓数据集制作
2、协助pcb软件发布
3、优化分级算法

### 20210906

1、规则轮廓缺陷数据集制作。
2、差异化数据增强对比验证。
3、尝试比对分类补漏。
4、优化分级算法。
5、请假1天。

1、已完成。
2、差异化增强acc低0.7，漏检率略低，错例分析效果不明显。
3、尝试比对的方法。小数据集效果好，消除漏检，同时混淆降低，大数据集效果略差。检查发现大数据孪生网络输出明显不一致。猜测bn层推理时的均值方差不一致。
4、未完成。

1、尝试比对分类补漏。
2、移除分类自带增强。
3、算法库bug修复。

#20210913

1、尝试比对分类补漏。
2、移除分类自带增强。
3、算法库bug修复。

1、推理时拷贝bn层参数保证两侧网络输出一致，大数据集上测试。漏检为普通分类的一半，对未知较大面积缺陷检出能力强，易漏检小缺陷，低对比度缺陷。
2、已完成。移除后在pcb数据集上的指标无明显变化（0.06%）。
3、部分完成。

1、测试新增数据增强效果。
2、更新数据集，测定baseline。
3、确认解决显存泄露问题。
4、PCB算法库切换至430

#20210922

1、确认并解决内存泄露的问题。
2、aidi_vision分支合并430。
3、测试新增数据增强效率，效果。
4、更新数据集，测定baseline。

1、已完成。
2、已完成，roi分类沿用旧有数据增强。
3、微弱提升（91.86|91.71），普通分类最多增加3个新参数，否则cpu跟不上gpu（TITAN XP）；roi分类新增参数效率降低。
4、处理新标签，部分调整，指标略微降低（91.5|91.2）

#20210927
1、aidi_vision430分支代码合并。
2、通用增强在PCB数据集上的效果，效率测试。
3、更新PCB数据集，测定baseline。
4、筛选算法库430分支适配，代码优化。

1、roi分类（部分增强）兼容通用增强，去除冗余代码及部分函数重新实现。
2、效果：微弱提升（91.86|91.71）效率：分类（2张），参数>3，roi分类（3张），参数>0时效率降低（TITAN XP）。
3、合并标签，更新配置文件，测试，指标微降（91.5|91.2）
4、抓取错误信息，训练推理及配置文件合法性检查，完善回调函数，显存释放，部分函数的重新实现等。

1、筛选算法库430分支适配，代码优化。
2、调试，并测试所有功能，更新接口文档。

# 周三
1、尝试比对分类补漏。
2、移除分类自带增强。
3、算法库bug修复。
4、aidi_vision分支合并430。
5、测试新增数据增强效率，效果。
6、更新数据集，测定baseline。

1、推理时拷贝bn层参数保证两侧网络输出一致，大数据集上测试。漏检为普通分类的一半，对未知较大面积缺陷检出能力强，易漏检小缺陷，低对比度缺陷。
2、已完成。移除后在pcb数据集上的指标无明显变化（0.06%）。
3、已完成。
4、已完成，roi分类沿用旧有数据增强。
5、微弱提升（91.86|91.71），普通分类最多增加3个新参数，否则cpu跟不上gpu（TITAN XP）；roi分类新增参数效率降低。
6、处理新标签，部分调整，指标略微降低（91.5|91.2）

1、筛选算法适配aidi_vision430及代码优化
2、新增增强参数调优。

#Q4工作计划

1、aidi_vision版本切换及筛选算法适配。（2w）
2、通用增强最优参数调优。（2w）
 - 测试新增的数据增强在PCB数据集上的效率和效果，测定最优参数。
3、渗金，错位等风险缺陷补漏。（4w）
4、根据实际需求，完善筛选算法库，修复相关bug。（2w）
备注：11月30日前完成pcb筛选算法现阶段的收尾工作，后续工作待安排。

#20211018

1、筛选算法版本更新，代码优化。
2、更新接口文档。
3、调试，测试所有功能。
4、重写测试demo。

已完成。发布新版adc库，包括，库，文档，测试用例，完整信息测试数据集。

1、数据集整理。
2、渗金等风险缺陷补漏等相关实验。
3、通用增强最优参数调优。

# 20211026

1、渗金，错位等补漏实验及实验分析。
2、代码修改。

1、缺陷轮廓规整，直接提取特征，下采样差异信息消失，造成漏检。
（1）调整孪生网络输出一致。a)输入层、特征层的融合，能有效补漏，但过检增加严重。b)特征层融合+ROI，只对比对ROI内信息，有效补漏，过检很少。
（2）不需要色域转换，能有效检出掉桥。
（3）数据增强作用下降。
（4）测试集（6468）：14漏检->0漏检;筛选率82%，过检数据中半数存在缺陷。
2、已完成。

1、重新划分数据集，验证结果。
2、通用数据增强参数调参。

# 20211027周三

1、筛选算法版本更新，代码优化。
2、更新接口文档。
3、调试，测试所有功能。
4、重写测试demo。
5、渗金，错位等补漏实验及实验分析。
6、adc库代码修改。

1、已完成。
2、已完成。
3、已完成。
4、已完成，发布新版adc库，包括：库，文档，测试用例，完整信息测试数据集。
5、缺陷轮廓规整，直接提取特征，下采样差异信息消失，造成漏检。特征层融合+ROI，只对比对ROI内信息。可有效检出掉桥，考虑移除hsv。测试集（6468）：14漏检->0漏检;筛选率82%，过检数据中半数存在缺陷。
6、已完成。

1、重新划分数据集，验证结果。
2、通用数据增强参数调参。
3、分级任务。

# 20211101

1、实验结果验证。
2、修复禅道bug。
3、通用数据增强调参。

1、已完成。重新划分数据集，补全数量不足类别，训练新模型，实验结果符合预期。
2、已完成。输入数据，格式处理错误导致训练卡死。
3、逐一对比新老版本数据增强效果，打开亮度、噪声、颜色滤镜（关闭红绿），普通分类漏检降低，混淆增加。

1、通用数据增强调参。
2、代码修改，适配430通用增强。
3、PCB筛选分类阶段性总结。

# 20211108
1、通用数据增强调参。
2、代码修改，适配430通用增强。
3、配置文件更新，新json格式。
4、分类阶段性总结。

1、已完成。几何变换+模糊最优，新增光照，滤镜，噪声等效果不佳。
2、已完成。
3、已完成。
4、部分完成。

1、分类阶段性总结&汇报。
2、分级baseline测试，问题分析。

# 周三20211110
1、分类实验结果验证。
2、通用数据增强参数调参。
3、修复禅道bug。
4、代码修改，适配430通用增强。
5、配置文件更新，json四合一。
6、分类阶段性总结。

1、已完成。扩大数据集，并重新划分数据集，实验结果符合预期。
2、已完成。逐一对比新老数据增强效果，对噪声、滤镜、蓝色滤镜、模糊等调参，最优为几何变换+模糊。
3、已完成。特定格式数据训练卡死的问题。
4、已完成。普通分类和ROI分类的适配。
5、已完成。同步需求至PCB缺陷类型配置软件。
6、部分完成。

1、分类阶段性总结&汇报。
2、分级baseline测试，问题分析。
3、同步分级标准。
4、分级思路验证。

# 20211110会议纪要：
1、训练，推理效率问题。（2W）
 - 在与现场配置相应的服务器上测试训练效率，拆分训练时间，分析并尝试优化效率。
 - 给出对应的硬件配置建议。
 
2、修改算法库接口。
 - 技术隐藏，修改变量及输出等命名。
 - 移除准确率。
 
3、软件（SDK）说明手册。
  - 表意通俗易懂，不暴露相关技术。
  
4、算法设计文档，归档。

# 20211115

1、分类阶段性总结&汇报。
2、分级baseline测试，问题分析。
3、训练效率测试。
4、数据中心&汕头超声分类分级标准。

1、已完成。
2、全集acc90%，分级acc在50%~80%之间，热力图错误，网络学习效果较差。
3、4卡较2卡节省40%耗时(7.8-4.8)，batchsize无明显影响。
4、和吕德初步对接。深南数据停止收集，绿油板->黑油板，分级标准定量。

1、过一遍汕头超声数据集(8w)，提出问题和需求，近期收集数据。
2、筛选算法接口修改。
3、软件说明手册。

# 20211122

1、过一遍汕头超声数据集(8w)，提出问题和需求，近期收集数据。
2、筛选算法接口修改。
3、软件说明手册。

1、已完成。和吕德对齐了超声的分级标准，不同厂的标准不一样如何分级？数据中心的数据质量较高，但无ROI，OK数据较少。
2、已完成。移除准确率，修改名称，更新部分功能。更新至发布版adc测试工具。
3、已完成。打包发布。

1、训练推理效率分析优化(17-30)。
2、分级实验。


# 20211129(周三)

1、分类阶段性总结&汇报。
2、分级baseline测试，问题分析。
3、数据中心&汕头超声分类分级标准。
4、超声数据集(8w)，提出问题和需求。
5、筛选算法接口修改。
6、软件说明手册。
7、adc算法库发布。

1、已完成。
2、全集acc90%，分级acc在50%~80%之间，热力图错误，网络学习效果较差。
3、和吕德对接，深南数据停止收集，绿油板->黑油板，分级标准定量。
4、已完成。分级问题存在疑虑。数据中心的数据质量较高，但无ROI，OK数据较少，目前正在标注。
5、已完成。移除更新部分功能，技术隐藏。
6、已完成。
7、已完成。

1、训练推理效率分析优化。
2、分级实验。
3、筛选算法设计文档。


# 20211129

1、服务器测试环境配置。
2、训练推理效率分析优化。
3、分级实验。

1、已完成。(RTX3080，i7-8700)
2、已完成。a)推理。多模型推理速度变慢的问题，跨gpu。推理效率：增强9.28ms，推理4.94ms（1.08，1.09，1.11，1.66），读数据1.22ms，获取结果0.44ms，其他0.36ms，总耗时16~17ms，不增强7ms。b)训练。（1）数据增强bug（2）单gpu绑定更多线程5->10。gpu利用率在80~90%。训练效率：epoch = 1500，RTX3080，24h/10k。RTX3080的浮点计算速度约为titan xp的2倍，实际训练速度为1.45~1.63倍，等于2块titan xp。
3、未完成。

1、epoch实验。
2、汕头超声数据加ROI。
3、分级实验。

1、分级实验。
固定特征提取(conv)，训练分类(fc)。AVE,AVE33。
2、分级标准(张辉)。
3、数据集切换，分级标准。
4、算法设计文档。

# 20211206

1、epoch实验。
2、分级实验1。
3、超声结果复现和分析。

（1）epoch=800，1000，1200时，漏检，混淆率等指标皆不如1500。
（2）将热力图转换成分割label输出，分类正确时结果较为准确，但不够精细。（分级能力暂不好评估）
（3）27类，4w数据，用分类模块同时分类分级，卡阈值（0漏检，70筛选率）。实际acc：91.0%，漏检3/12523，深南数据集漏检55/3000（旧有实验）。原因：a)数据质量高 b)OK为假OK（OK漏检转换成了各类别的轻度漏检，阈值0.85） c)只分两级。混淆率甚至提高了，深南7.82%，超声7.99%。实际：2.4%级别上升（过检），2.8%级别下降（漏检）。

OK数据混入了缺陷各类别的轻度，数据集结构不一样，
难以确定比较基准，也不好在新数据集上做实验。

（1）超声现有算法和数据集分析讨论。
（2）判断分级效果的指标。
（3）等待新数据（士清工具 + 现场收集），在深南数据集上做一些分级实验。

# 20211208

1、服务器测试环境配置。
2、训练推理效率分析优化。
3、epoch实验。
4、分级实验1。
5、超声结果复现和分析。

1、已完成。(RTX3080，i7-8700)
2、已完成。a)推理加速。多模型推理速度变慢的问题，跨gpu。b)训练加速。（1）数据增强bug（2）单gpu绑定更多线程5->10。RTX3080的浮点计算速度约为titan xp的2倍，实测训练速度为1.45~1.63倍，等于2块titan xp。
3、已完成。epoch=800，1000，1200时，漏检，混淆率等指标皆不如1500。
4、将热力图转换成分割label输出，分类正确时结果较为准确，但不够精细。（分级能力暂不好评估）
（3）27类，4w数据，实测acc：91.0%，漏检3/12523。实际：2.4%级别上升（过检），2.8%级别下降（漏检）。

（1）讨论确定基准数据集。
（2）准备测试工具，测试数据，测试结果等，配合现场测试。
（3）数据更新前，在深南数据集上做一些分级实验。


#20211213

1、新算法测试验证的讨论。
2、OK数据采集工具。
3、一组分级对比实验。

1、已完成。消除了各方存在的一些误解。在超声（偏重分级），美维（偏重分类），深南（折中）等数据集上测试。
2、已完成。提供数据转换接口，士清给出工具，测试后交付给相关同事。
3、观察直接训练分级学习的特征混乱，继承分类模型，固定卷积训练，分级效果优于直接重新训练。

1、对接数据集，配合现场测试。
2、继续分级实验。


# 20211220
1、面积维度的分级实验。
1、超声数据集制作，模型训练。
2、配合现场测试。
3、比对分类合入aidi_vision。

1、基于热力图卡阈值输出分割结果，统计分析缺陷面积与严重程度的关系（金面刮伤），结论：不足以完全区分轻度和严重缺陷。
1、周二收到新采集的OK数据，制作完整的数据集（OK数据随机生成ROI，缺陷ROI合并至分类标签，数据清洗等），现有超声数据集已满足分级实验要求，训练模型供后续实验。
2、现场测试进度较慢，目前完成深南数据集结果复现。
3、已完成。在分类模块添加参数，内部实现比对网络的构建，实现训练推理，可复用100,101模型，已提交到gitlab。

昆山出差，主要目标：
1、了解项目启动到交付的整体流程。
2、了解现场实际实施的算法方案，迭代流程，指标评价方式等。
3、尽可能和工厂QA交流，获取实际的分级维度和分级需求。
4、推进新算法（新分类算法，新配准模块）的测试和应用。

# 20211227
1、了解现场实际算法方案，迭代流程，指标评价方式等。
2、和工厂QA交流，获取分级标准。
3、adc软件相关。

1、熟悉现场软件，和现场同事讨论交流，进厂实践。
2、未细化至具体类别，但了解到一些真实的需求。
3、修复了一些测试组提交的bug，测试结果阅读指南。

1、新分类算法在南亚interposen现场的验证。
2、年终总结。
3、返京。

#20220104
1、新算法南亚interposen现场验证。
2、准备年终述职。
3、返京。

1、新算法现场打点数据暂无漏检。
2、已完成。

1、请假1天。
2、南亚出差总结汇报。
3、interposen漏检分析。

#20220110
1、请假1天，年终述职。
2、现场漏检数据测试。
3、适配现场筛选软件，c#打包。
4、南亚现场情况小结。

1、已完成。
2、分类漏检65张->6张（ROI错误，缺数据，OK缺陷）。
3、已完成。
4、待完成。

1、南亚现场总结汇报。
*缺陷分级。
*未知缺陷检出实验。

# 20220112 周三
1、南亚出差。
2、现场情况总结汇报。

1、interpose项目仍在继续，需要继续跟进；比对分类已嵌入现场软件（临时测试），今天开始打点测试。
2、已完成。

1、跟进interpose项目。
2、分级数据集需求。
3、缺陷分级。

# 20220117
1、南亚总结汇报。
2、宜美智AI模型分析。
3、比对分割。

1、已完成。
2、分析以宜美智AI，模型输入输出及各项参数。MXNet，resnet34，resnet50,3*112*112，bn和部分卷积层有改动。
3、迁移比对分类，基于现有分割模块在外部导入模型，实验。

1、分级数据需求。
2、南亚漏检分析，模型训练。
3、比对分割实验（数据，baseline，模型）。

# 20220124

1、比对分割aidi_vision实现。
2、论文分享。
3、分级需求讨论及OKR。

1、已完成。
2、已完成。
3、暂时以南亚、超声、美维标准做分级。

1、比对分割数据集制作。
2、baseline实验。

#20220126 周三
1、宜美智AI模型分析。
2、分级需求讨论及OKR。
3、论文分享。
4、比对分割aidi_vision实现。

1、分析以宜美智AI，模型输入输出及各项参数。
2、已完成。
3、已完成。
4、已完成。

1、比对分割baseline。
2、新算法超声数据集测试。

# 20220209
1、新算法测试结果讨论。
2、超声数据集问题和梳理点。
3、比对分割baseline。

1、已完成。
2、已完成。详细给出超声数据集梳理要点，输出文档。
3、数据集挑选和标注，部分完成。

1、准备新算法对比测试的相关工具。
2、新算法对比测试方案。
3、完成比对分割baseline。


# 20220214
请假2天。
1、比对分割baseline。
2、准备新算法对比测试的相关工具。

1、上采样前比对，点指标低于默认分割，区域指标优于默认分割。
2、部分完成。同步旧算法方案及指标计算。

1、准备新算法对比测试的相关工具。
2、对比测试方案。
3、前次算法测试报告中的问题修复。

# 20220216 周三
1、新算法测试结果讨论。
2、超声数据集问题和梳理点。
2、准备新算法对比测试的相关工具。

1、已完成。
2、已完成。详细给出超声数据集梳理要点，输出文档。
3、部分完成。同步旧算法方案及指标计算。

1、准备新算法对比测试的相关工具。
2、对比测试方案。
3、前次算法测试报告中的问题修复。
4、为测试组准备数据，给出测试需求和测试重点，简单培训。
5、超声数据集新旧算法对比测试。

# 20220221

1、前次测试报告中的问题修复。
2、对比测试工具&超声数据预处理。
3、测试计划&对比测试。
4、一组比对分割实验。

1、已完成。修改综合判断逻辑和相关配置。
2、已完成。按新旧算法分别处理数据，待补充。
3、和士清讨论了测试计划，完成模型训练，待分析。
4、248下采样+比对损失，效果不佳。

1、对比测试及分析报告。
2、其他工作。

# 20220228

1、筛选对比测试及分析报告。
2、比对分割相关工作。
3、体素化相关知识学习。

1、已完成。
2、逐层可视化，漏检数据特征分析，效果接近时比对分割特征较乱。
3、Pointnet。

3D分割相关论文阅读调研（Voxel）。


# 20220302 周三

1、修复前次报告中提到的问题。
2、超声数据预处理，新老算法模型训练。
3、对比测试分析，ppt报告。

1、已完成。修改综合判断逻辑和相关配置。
2、已完成。
3、已完成。

3D分割相关工作。


# 20220307

1、基于体素化的3d检测论文阅读（voxelnet）。
2、3d分割相关调研。

1、论文&源码阅读。
2、调研3d数据形式（点云，网格，体素，RGB-D，投影等）；3d数据集及各数据集上的任务，最佳指标等；找到相关综述3篇。

阅读综述及综述相关引文。

# 20220314

阅读综述及综述相关引文。

阅读三篇综述，并根据综述梳理技术路线，目前总共有四条AI路线，一条传统路线。上周对其中基于体素的路线进行了深入学习。

继续文献调研。

# 20220321

3D分割文献调研。

公开数据集S3DIS，SemanticKITTI，Semantic3D排行榜最新论文阅读，主要阅读基于voxel-based和fusion技术路线论文。

着重阅读point-based（point-wise，point-conv）的技术路线。

# 20220328

3D分割基于非结构化点的技术路线调研。

子技术路线：point-wise，point-conv，graph-based，lattice-based，rnn-based；基于点的方法在室内小数据集上的最优指标和voxel-based方法差距不大，但效率偏低；point和voxel融合的方法指标和效率最佳。

调研3D分割基于图像的技术路线，子技术路线：RGB-D，multi-view，range，fusion。

# 20220406
调研3D分割基于图像的技术路线，子技术路线：RGB-D，multi-view，range，fusion。

已完成。

3D分割技术路线总结。对比分析效率，内存占用，指标等，挑选出更适用于工业场景的技术路线，输出PPT。

# 20220411

3D分割技术路线总结。

已完成。

1、3D分割文献调研汇报。
2、PCB相关工作（SOP，数据质量等）

# 20220418

1、3D分割调研报告
2、PCB数据及测试反馈
3、3d稀疏卷积代码编译

1、已完成。
2、已完成。
3、SparseConvNet库，底层C++，封装python，默认linux，修改cpp到windows平台，gpu，cpu编译通过。

公开数据集上跑通代码，包括手写字符，ScanNet，nyu2等。

# 20220425

1、3D数据预处理。
2、3D稀疏卷积公开数据集实验。
3、PCB相关。

1、已完成。为了可视化和训练，实现了tiff，pts，pcd等数据标签的相互转换。
2、在中文手写字符，shapenet，mvtec数据集上跑通代码。
3、提出测试需求，跟进进度，周五例会。

1、顶焊数据标注。
2、3D稀疏卷积在顶焊数据集上的实验，测试指标。

# 20220509
1、顶焊数据标注。
2、稀疏卷积+unet训练。

1、尝试使用网页标注工具SUSTechPOINTS，运行卡顿，单张标注，无分割标签。AIDI分割2D标签转3D标签（显示bug），得到标注ng数据115张，4类，ok-194.
2、单个样本大，200mb，标签20mb，batchsize=2；数据预处理慢（体素化），收敛迅速（3epoch），下采样5，训练集miou=0.7；缺陷占比小，需平衡采样点数，同时保证缺陷特征明显。

# 20220516

1、细化指标计算。
2、读稀疏卷积代码，调参（分辨率，体素填充等）。

1、修改iou计算，增加测试集指标，过检，漏检等。测试集漏检1/20，过检2/16，iou=0.55。
2、图像尺寸大于300，学习失败；分辨率较大时，卷积感受野小效果差，分辨率较小时，信息丢失效果差；体素空间较大，效果差；学习率，学习率衰减方式，batchsize，体素表现形式等；测试fcn和unet，unet较优；

1、继续阅读源码，更换resnet，调参。
2、结果可视化。
* 周五，AIDI分类模块问题分析报告（超声数据）。


# 20220523

1、继续阅读源码，更换resnet，调参。
2、顶焊数据集预处理。
3、比对分类相关。
4、PCB相关讨论。

1、未完成。
2、数据集标注，aqlabel，tiff转换成pts，pcd等数据格式，训练测试集划分。
3、merge最新分支，分析旧有实验数据，补充实验报告。
4、已完成。

# 20220530

1、3D稀疏卷积搭建resnet，顶焊数据集测试，调参。
2、PCB-ARS问题研究的准备工作。

1、完成resnet搭建；128数据集，iou最高0.55；300数据集训练失败，调节分辨率训练收敛，最优指标iou=0.35，漏检10%，过检3%；缺少2d的baseline；分辨率和学习率对结果影响大。
2、数据下载，预处理，数据集划分，类别统计，结果复现，指标计算。

挑选典型数据为训练集，做第一轮迭代分析。

# 20220606

1、3d结果可视化。
2、3d稀疏卷积的显存效率分析。

1、已完成，将3d分割结果及标签映射到2d灰度图。
2、已完成。

1、错例分析，实验小结。
2、比对分割调研。

# 20220613

1、3D分割体素路线错例分析，小结。
2、比对分割调研。
3、公开数据集上，AIDI分割baseline。
4、PCB相关。

1、已完成，输出ppt。
2、确定关键词，CL，CD；数据集有，街景，卫星，异构等；寻找综述，针对卫星数据居多。
3、下载处理CDD数据集；训练开启几何变换，F1：92.87/97.34，高于2020前，测试集指标和训练集持平。
4、现状：5000张数据，初步迭代模型，分析，小缺陷问题。

1、阅读综述。
2、RDPNet，SNUNet，ChangeStar等论文阅读。

# 20220620
1、比对分割综述及论文阅读。
2、顶焊数据2D展平算法baseline及效率测定。

1、FCS，SNUNet，RDPNet，SDADC等，技术路线较为单一，多以孪生网络为基础，后在网络结构，特征提取，融合，跨域检测，loss设计，训练策略等方面做优化。
2、确认需求为1.25s/图，2d算法单图110ms，rc：0.56，pr：0.52，iou约0.37

1、pcb数据集review，漏检分析。
2、继续比对分割调研。

# 20220627
  
1、pcb数据集review，漏检分析。
2、比对分割调研。

1、已完成，已列出问题优先级，待解决。
2、已完成。基于attention和transformer的论文调研。

1、基于two-stage，patch，loss优化等相关论文阅读。
*PCB算法优化。

# 20220704

1、常规缺陷漏检原因，查明原因。
2、算法相关实验。

1、已完成，逐层可视化发现，conv2_1/sep浅层已提取出特征，conv5_2/sep层特征残留，conv5_3/sep特征消失；训练集类似样本分类正确，但特征提取也失败了。原因：a)类似样本较少（1张）；b）网络特征提取能力待加强。
2、考虑到缺陷特征在深层消失的问题，尝试了一些方法，其中比对+深度监督的方式效果很好。效率上推理时间不变，同时上述缺陷不再漏检，漏检率由2.54%（35）降至1.38%（19），其中11个为面积型缺陷，及类间差异小导致漏检。

算法相关实验，引入ROI，降低漏检，控制过检。

# 20220711

1、PCB分类算法需求再确认。
2、代码开发。

1、已完成。
2、深度监督集成aidi_vision，同时兼容比对。

1、数据转换，ROI分类集成。
2、比对分割数据集。

# 20220718

1、ROI分类代码集成。
2、数据预处理+8组实验。
3、中期汇报PPT。
4、比对数据集的准备工作。

1、ROI、比对、深度监督已兼容集成，打包pcb定制版AIDI。
2、8组实验，比对和dsn降低漏检，roi降低过检。目前比对+dsn指标最优0.87%，4.68%（2.54%，2.52%），训练耗时+60%，其中dsn+10%，加ROI只降低过检，漏检可能增加。
3、已完成。
4、比对分割问题定义待确认，测试组暂无人配合标注。

1、pcb版AIDI自测（热力图显示，推理无结果，参数显示，提示错误，指标计算错误等）
2、极速推理实现
3、比对分割数据集
4、实验结果分析

# 20220725

1、极速推理实现
2、pcb版AIDI自测
3、实验结果分析
4、比对分割数据集

1、各模式下实现了极速推理，经验证，ROI分类推理正常，比对推理结果不一致，可能和权值共享的双分支网络有关（现版本TRT暂不支持）。
2、修复热力图错误，推理无结果，输入错误崩溃，指标计算错误等问题，初版已交付。
3、未完成，因为直接用ROI的效果不是太好，所以补充了一组roi-channel-attention的实验，结果一般。
4、进行中，正在挑选数据，测试组预计这周帮忙标注。

1、挑选比对数据交测试组同事标注。
2、实验分析总结。

# 20220801

1、挑选比对数据交测试组同事标注。
2、实验分析总结。

1、已完成。从超声8w大数据集挑出1000数据，标注，校验，划分数据集（100张难数据）。
2、已完成。PCB现场的测试报告下周才能完成。

开始比对分割实验。

#20220808
1、比对分割相关实验。
2、错例可视化分析。

1、101和102的FC-diff效果差距较大，102优于101；102-FC-diff效果接近单分支网络；abs层对101有效，在102上效果变差。
2、AIDI上添加测试参数，单图测试可视化漏检数据，发现decoder大多提取出缺陷，但softmax后的缺陷值仍小于背景值，最终漏检。FC-diff输出特征图差值，数值较小，可能需要优化decoder适应siam。

1、比对分割，优化decoder，loss实验。
2、pcb相关，算法迭代。

#20220815

1、比对分割网络优化。
2、pcb相关，算法迭代。

1、百组消融对比实验，不做调整时，siam-diff-101召回0.491；关于encoder部分，空洞数量，大小，卷积核大小对siam网络性能影响较大；encoder部分，layer初始化，loss，abs层，第一层卷积反卷积kernel_size和stride设计等对性能影响大；通道注意力（提升指标明显），空间注意力（提升精度，可视化，还需优化）；指标0.7622，优于101（0.6919），略低于102（0.7715）。
2、未进行。

1、PCB定制版分类修改，发布。
2、decoder优化（输入、空间注意力，卷积反卷特征提取等）

# 20220822

1、PCB定制版分类修改，发布。
2、比对分割decoder优化。

1、增加忽略最后一层数据功能，ok数据自动添加ROI，已打包发布。
2、decoder出来的结果多空洞，加bn层效果改善，但比对型缺陷检出效果变差；deconv的学习率置零；增加通道数；增加conv层数；deconv分组设置；conv卷积核大小；初始化参数；decoder输入等。

1、比对分割实验小结。
2、Kp-conv代码review。

# 20220829

1、比对分割实验小结
2、Kp-conv代码review

1、已完成。
2、可优化的点有两个：显存优化，代码追求简便，现浪费大量显存，按单图采样10万点，优化后的batchsize可提升5倍左右，训练速度，稳定性预计也能提升；数据预处理，计算各点领域空间耗时多，但并行性好，cuda加速预计能到毫秒级。当前，集成可见工作主要有：数据预处理加速、在caffe中实现kpconv、pooling，gather等layer。

1、kpconv数据生成，后处理等代码阅读。
2、比对分割二阶段实验。

# 20220905

1、kpconv数据生成，后处理等代码阅读。
2、比对分割二阶段实验。
3、PCB相关。

1、已完成，训练推理各部分效率分析，新增激光焊数据集。
2、消融实验，目前像素召回0.8313（baseline：0.7932），最高精度0.9258（0.8991）。
3、软件完成，准备验证阶段；多次训练显存释放失败，训练开始卡主，打印冗余日志。

继续比对分割相关实验。

# 20220913

1、比对分割实验（比对特征提取，深度监督，模型压缩，指标稳定性）
2、pcb相关。

1、比对不需要提取深层特征，浅层网络效果好（300kb模型稳定且效果好，但不够精细）；下采样次数多，比对特征容易缺失；decoder凸显特征，消除背景；深度监督效果不佳；目前指标可稳定在0.8以上，训练推理速度由于102。
2、原定15号测试完成，延后。上周配好环境，这周开始测试。

优化比对分割模型精度，结合明楨实验结果得到稳定收敛的最优模型。

# 20220919

比对分割实验及实验结果分析。

重新测定baseline，cd200-6%，cd1000-4%，相对上周提升1%左右；模型效率，稳定性，比对能力，cd1000像素召回，模型潜力等对比；网络裁剪，优化；模型4-速度一般，指标第二高，稳定，无跳层，模型9-速度更快，指标最高，不稳定，有跳层。

1、比对分割模型微调，稳定性分析，实验小结。
2、3d分割集成相关工作。

# 20220926

1、比对分割模型微调，稳定性分析，实验小结。
2、3d分割集成相关工作。

1、已完成。
2、开始分解kpconv和公式推导。

1、分解kpconv及公式推导。
2、熟悉2.5D项目背景。

# 20221010

1、分解kpconv及公式推导。
2、熟悉2.5D项目。

1、weight_diff的计算和一般卷积相同，但data转换不同（类比im2col，需根据邻域点信息转换data）；梯度传递bottom_diff的计算略有不同，需增加W0矩阵（kp-conv卷积核加权，常量），同时需类比col2im对梯度还原，W0计算需要更加邻域信息对输入做转换。
2、了解了项目背景和基本需求，安装halcon，熟悉halcon相关算子和代码调试。任务有三：标定获取光源方向；有标定重建；无标定重建。重建内容包括：反射率->法向量->梯度->形状图，梯度->高度图。目前搞清了标定，以及从反射率到求解形状图的计算逻辑，高度图的求解和无标定算法暂未弄明白。

1、学习基于泊松重建（poisson）等方法的高度图求解。
2、学习无标定重建方法。

# 20221018

1、有标定重建方法学习。
2、无标定重建方法学习。

1、光度立体学相关知识学习，根据入射角求解梯度，梯度积分得到高度信息。
2、反射率、法向量求解，梯度、曲率求解，深度求解（泊松重建）。

1、熟悉aqcv库及相关同事的python代码。
2、在aqcv中实现相关功能。

# 20221024

1、熟悉aqcv库及相关同事的python代码。
2、在aqcv中实现标定算法。
3、pcb相关。

1、已完成。aqcv基于opencv源码，大部分函数调用相同，部分函数在外部重新封装。python由梯度计算曲率的代码。
2、根据相关资料实现了一版标定光源方向的算法，旋转角和halcon基本一致，倾斜角相差较多。
3、基于新需求，推理可视化输出top5的热力图，临时发布。

1、查找原因，修改标定算法，使其和halcon一致。
2、有标定法向量，反射率计算。

# 20221031

1、查找原因，修改标定算法，使其和halcon一致。
2、有标定法向量，反射率，梯度图计算。
3、pcb相关。

1、已完成，halcon标定小球为朗伯体，需采集大量点构建方程组，svd矩阵分解。目前，标定结果和halcon一致（定位小球位置时略有不同，halcon采用的圆模板匹配）。
2、已完成，法向量，反射率计算值和halcon一致，根据halcon的计算方式归一可视化输出图像也一致。
3、现场测试反馈部分问题，多次推理结果不一致问题，经查找，模型不一致。

1、有标定时，高斯曲率，平均曲率，高度图计算
2、无标定时，反射率，法向量计算。

# 20221107

1、有标定时，高斯曲率，平均曲率，高度图计算
2、无标定时，反射率，法向量计算。

1、完成高斯曲率，平均曲率计算。计算高度图用到了最小二乘，求解大规模稀疏矩阵，目前超时且结果不太对。
2、无标定计算需有一定约束，目前假定光源大于6且光强一致，矩阵分解存在一定问题，待解决。

1、解决高度图计算超时问题，且调试结果正确。
2、解决无标定法向量计算的矩阵分解问题。

# 20221114

1、单元测试。
2、梳理代码，提交到git仓库。

1、已完成。自动拉取云盘数据测试，测试对比标定，法向量，反射率，形状图等。
2、已完成。梳理代码并提交；根据牛哥的建议修改部分实现，二次提交。

1、解决高度图计算超时问题，且调试结果正确。
2、解决无标定法向量计算的矩阵分解问题。

# 20221121

1、光度立体算法效率测试。
2、光度立体算法效率优化。

1、已完成。编写halcon代码，测试对比效率。halcon速度为初版Aqcv-PhotometricStereo的5倍，法向量，曲率等耗时均为200ms左右。
2、已完成。优化反射率，法向量，梯度，平均曲率，高斯曲率的计算效率，目前均优于halcon，其中法向量等速度为halcon的2~3倍，曲率为halcon的1.8倍左右；对比效率和效果，输出ppt。

1、光度立体算法结果汇报，代码整理提交。
2、继续下阶段工作（高度图，无标定计算等）。

#20221128
1、光度立体算法汇报。
2、协助效率对比测试。
3、无标定算法研发。

1、已完成。
2、已完成，对接到白杨杨-杨志强，测试demo。
3、开源算法，halcon算法对比，无标定时法向量及亮度图效果差，平均曲率较好（检出缺陷的关键）；halcon带标定算法反推标定小球法向量发现halcon精度差；复现无标定算法论文结果遇到一些问题在解决。

1、无标定算法研发。
2、3d分割数据预处理代码review。

#20221205

1、光度立体算法研发。
2、3d分割数据预处理代码review。
3、OKR相关。

1、有标定：优化平均曲率效果，提供模糊参数供测试；优化标定时间。无标定：基础版本，法向量计算在部分数据上优于halcon，反射率，平均曲率效果接近halcon。
2、了解代码整体结构和实现的功能，未深入细节。
3、已完成。

1、3d分割代码review。
2、接手平移稳定性相关工作。

# 20221212
1、3d分割预处理代码review。
2、平移稳定性相关知识。
3、pcb相关。

1、阅读代码细节，确定测试方案。
2、了解项目背景和现有技术路线，学习相关知识，一篇文献。
3、pcb定制版功能更新；部分现场筛选率较低，需优化筛选率；借鉴比对分割做了些实验，attention可提高筛选率但漏检增加。

1、优化pcb分类筛选率。
2、无标定光度立体算法效率优化（效果的测试结果未出）。
3、平移稳定性算法优化（需要数据集和具体优化目标）

# 20221219
1、平移稳定性相关知识学习。
2、瓶盖数据集上实验。

1、学习图像频率，混叠，奈奎斯特频率，傅里叶变换等基础知识；网络模型对比；新增的caffe-layer等。
2、测试对比历史模型效果，部分旧有模型效果较差，过检高，现有模型（encoder部分加blur-layer，decoder部分有优化空间）和101差距不明显，缺少评价工具。

1、平移稳定性相关论文学习（3篇左右）
2、平移稳定性评价工具。


# 20221226
1、平移稳定性评价工具及测试。
2、光度立体算法。
3、平移稳定性论文。

1、已完成。直接读取aqlabel中的polygon计算面积、长宽的方差，计算缺陷堆叠iou；在瓶盖，圆环数据集上测试101，102和stable模型，定量指标：stable ≈ 102 > 101。
2、协助测试，修改测试反馈的相关bug，目前已提交merge，测试报告邮件发出。有标定：效率优于halcon，效果和halcon相似；无标定：效率低于halcon，不够准确。
3、略读了两篇论文，尝试寻找综述。

1、年终总结
2、光度立体分析报告
3、理清平移稳定性技术发展脉络（综述等阅读）

# 20230102

1、年终总结
2、光度立体分析报告
3、光度立体算法merge到aqcv
4、理清平移稳定性技术发展脉络（综述等阅读）

1、已完成。
2、已完成，邮箱已发出。报告对halcon的精确度和原测试报告中的一些问题做了具体分析，这周可以汇报。
3、修改牛哥那边review提出的一些问题，除标定部分的几个函数优化，其余已完成并合并到主分支。
4、未完成。

1、请假1天。
2、采用doxygen支持的格式完善接口注释，标定函数优化。
3、理清平移稳定性技术发展脉络（综述等阅读）

# 20230109

1、优化光度立体算法函数实现，调整注释及代码风格。
2、光度立体算法汇报，获取项目信息，阅读资料。

1、已完成。
2、1）推测：基恩士内嵌标定算法（4光源，结果质量高） 2）理论：平行光不影响标定结果，可重新计算标定参数 3）5项目2弃用，易鸿，精质-顶盖（基恩士），3C领益支架（halcon，尝试过无标定，弃用），圆环项目（少如，可能用无标定）。

基于2个约束条件优化无标定算法。

# 20230109

基于2个约束条件优化无标定算法。

1、完成6光源约束无标定算法，效果较明显，部分数据曲率图接近标定算法。
2、优化6像素约束无标定算法（4光源可用），取大量点拟合对称矩阵，修复法向量矩阵，效果最好，部分数据法向量和曲率图接近标定算法。halcon例程数据（小图）不如halcon，自采图像优于halcon。

无标定算法效率优化。

# 20230130
无标定算法效率优化。

已完成。方法1：先拟合光源方向，基于光源方向重新计算法向量，速度快，效果较差。方法2：对于大图，降采样计算各点法向量，速度快，效果较好，需手动设定降采样倍数。

光度立体算法示例代码和说明文档文。

# 20230206

1、光度立体算法示例代码和说明文档。
2、无标定效率效果优化代码merge和修改。
3、请假3天。

1、已完成。
2、已完成。

1、代码review，搭建3D分割模块，集成3Dcaffe layers和数据预处理至aidi_vision。
2、PCB新需求讨论。